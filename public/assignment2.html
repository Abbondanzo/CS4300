<!DOCTYPE html>
<html lang="en">
  <head>
    <title>A WebGL Mini CAD</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      canvas {
        border: 1px solid gray;
        text-align: center;
      }
      .container {
        width: 540px;
        margin: 0 auto;
        text-align: center;
      }
      form {
        text-align: left;
      }
    </style>
    <script id="vertex-shader-2d" type="x-shader/x-vertex">
      attribute vec2 a_coords;
      uniform   vec2 u_resolution;

      void main() {
        vec2 zeroToOne = a_coords / u_resolution;
        vec2 zeroToTwo = zeroToOne * 2.0;
        vec2 minusOneToOne = zeroToTwo - 1.0;
        // Modify this to change origin
        vec2 clipSpace = minusOneToOne * vec2(1, -1);
        gl_Position = vec4(clipSpace, 0, 1);
      }
    </script>
    <script id="fragment-shader-2d" type="x-shader/x-fragment">
      precision mediump float;
      uniform vec4 u_color;
      void main() {
        gl_FragColor = u_color;
      }
    </script>

    <script type="text/javascript" src="utils.js"></script>
    <script>
      const RECTANGLE = "RECTANGLE";
      const shapes = [
        {
          type: RECTANGLE,
          position: {
            x: 200,
            y: 100,
          },
          dimensions: {
            width: 50,
            height: 50,
          },
          color: {
            red: Math.random(),
            green: Math.random(),
            blue: Math.random(),
          },
        },
      ];

      let gl;
      let attributeCoords;
      let uniformColor;
      let bufferCoords;

      const init = () => {
        // get a reference to the canvas and WebGL context
        const canvas = document.querySelector("#canvas");
        gl = canvas.getContext("webgl");

        // create and use a GLSL program
        const program = createProgramFromScripts(
          gl,
          "#vertex-shader-2d",
          "#fragment-shader-2d"
        );
        gl.useProgram(program);

        // get reference to GLSL attributes and uniforms
        attributeCoords = gl.getAttribLocation(program, "a_coords");
        const uniformResolution = gl.getUniformLocation(
          program,
          "u_resolution"
        );
        uniformColor = gl.getUniformLocation(program, "u_color");

        // initialize coordinate attribute to send each vertex to GLSL program
        gl.enableVertexAttribArray(attributeCoords);

        // initialize coordinate buffer to send array of vertices to GPU
        bufferCoords = gl.createBuffer();

        // configure canvas resolution and clear the canvas
        gl.uniform2f(uniformResolution, gl.canvas.width, gl.canvas.height);
        gl.clearColor(0, 0, 0, 0);
        gl.clear(gl.COLOR_BUFFER_BIT);
      };

      const render = () => {
        gl.bindBuffer(gl.ARRAY_BUFFER, bufferCoords);
        gl.vertexAttribPointer(attributeCoords, 2, gl.FLOAT, false, 0, 0);

        shapes.forEach((shape) => {
          gl.uniform4f(
            uniformColor,
            shape.color.red,
            shape.color.green,
            shape.color.blue,
            1
          );

          if (shape.type === RECTANGLE) {
            renderRectangle(gl, shape);
          }
        });
      };

      const addRectangle = (e) => {
        // Prevent form button from submitting
        e.preventDefault();
        e.stopPropagation();

        const x = parseInt(document.getElementById("x").value);
        const y = parseInt(document.getElementById("y").value);
        const width = parseInt(document.getElementById("width").value);
        const height = parseInt(document.getElementById("height").value);

        const rectangle = {
          type: RECTANGLE,
          position: {
            x: x,
            y: y,
          },
          dimensions: {
            width,
            height,
          },
          color: {
            red: Math.random(),
            green: Math.random(),
            blue: Math.random(),
          },
        };

        shapes.push(rectangle);
        render();
      };
    </script>
  </head>
  <body onload="init();render()">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            A WebGL Mini CAD
          </li>
        </ol>
      </nav>

      <h1>A WebGL Mini CAD</h1>
      <canvas id="canvas" width="500px" height="300px"></canvas>

      <br />

      <form>
        <div class="form-row" width>
          <div class="form-group col-md-6">
            <label for="x">X:</label>
            <input class="form-control" id="x" value="20" />
          </div>
          <div class="form-group col-md-6">
            <label for="width">Width:</label>
            <input class="form-control" id="width" value="20" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="y">Y:</label>
            <input class="form-control" id="y" value="20" />
          </div>
          <div class="form-group col-md-6">
            <label for="height">Height:</label>
            <input class="form-control" id="height" value="20" />
          </div>
        </div>

        <button id="addRectangle" class="btn btn-primary">Add Rectangle</button>
      </form>
    </div>

    <script>
      document
        .querySelector("#addRectangle")
        .addEventListener("click", addRectangle);
    </script>
  </body>
</html>
